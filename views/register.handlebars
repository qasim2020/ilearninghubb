// Add this script to your page

document.addEventListener('DOMContentLoaded', function() {
  // First, add the Ticket Tailor script to the page
  const scriptTag = document.createElement('script');
  scriptTag.src = "https://cdn.tickettailor.com/js/widgets/min/widget.js";
  scriptTag.setAttribute('data-url', "https://www.tickettailor.com/all-tickets/islamiclearninghubb/?ref=website_widget&show_search_filter=true&show_date_filter=true&show_sort=true");
  scriptTag.setAttribute('data-type', "inline");
  scriptTag.setAttribute('data-inline-minimal', "true");
  scriptTag.setAttribute('data-inline-show-logo', "false");
  scriptTag.setAttribute('data-inline-bg-fill', "false");
  scriptTag.setAttribute('data-inline-inherit-ref-from-url-param', "");
  scriptTag.setAttribute('data-inline-ref', "website_widget");
  document.head.appendChild(scriptTag);
  
  // Create a hidden div to hold the widget
  const widgetContainer = document.createElement('div');
  widgetContainer.id = 'ticket-tailor-container';
  widgetContainer.className = 'tt-widget';
  widgetContainer.style.display = 'none';
  widgetContainer.style.position = 'fixed';
  widgetContainer.style.top = '50%';
  widgetContainer.style.left = '50%';
  widgetContainer.style.transform = 'translate(-50%, -50%)';
  widgetContainer.style.zIndex = '1000';
  widgetContainer.style.backgroundColor = 'white';
  widgetContainer.style.padding = '20px';
  widgetContainer.style.borderRadius = '10px';
  widgetContainer.style.boxShadow = '0 0 15px rgba(0,0,0,0.2)';
  widgetContainer.style.maxWidth = '90%';
  widgetContainer.style.maxHeight = '90%';
  widgetContainer.style.overflow = 'auto';
  
  // Create close button
  const closeButton = document.createElement('div');
  closeButton.innerHTML = '&times;';
  closeButton.style.position = 'absolute';
  closeButton.style.top = '10px';
  closeButton.style.right = '15px';
  closeButton.style.fontSize = '24px';
  closeButton.style.cursor = 'pointer';
  closeButton.style.color = '#333';
  closeButton.onclick = function() {
    widgetContainer.style.display = 'none';
    document.body.style.overflow = 'auto'; // Enable scrolling again
  };
  
  // Create fallback content
  const fallbackDiv = document.createElement('div');
  fallbackDiv.className = 'tt-widget-fallback';
  fallbackDiv.innerHTML = '<p><a href="https://www.tickettailor.com/all-tickets/islamiclearninghubb/?ref=website_widget&show_search_filter=true&show_date_filter=true&show_sort=true" target="_blank">Click here to buy tickets</a><br /><small><a href="https://www.tickettailor.com?rf=wdg_247311" class="tt-widget-powered">Sell tickets online with Ticket Tailor</a></small></p>';
  
  widgetContainer.appendChild(closeButton);
  widgetContainer.appendChild(fallbackDiv);
  document.body.appendChild(widgetContainer);
  
  // Add overlay background
  const overlay = document.createElement('div');
  overlay.id = 'ticket-tailor-overlay';
  overlay.style.position = 'fixed';
  overlay.style.top = '0';
  overlay.style.left = '0';
  overlay.style.width = '100%';
  overlay.style.height = '100%';
  overlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
  overlay.style.zIndex = '999';
  overlay.style.display = 'none';
  overlay.onclick = function() {
    widgetContainer.style.display = 'none';
    overlay.style.display = 'none';
    document.body.style.overflow = 'auto'; // Enable scrolling again
  };
  document.body.appendChild(overlay);
  
  // Update all register now buttons to open the Ticket Tailor widget
  const registerButtons = document.querySelectorAll('a[href="/register"]');
  registerButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      widgetContainer.style.display = 'block';
      overlay.style.display = 'block';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
      
      // Initialize or refresh the widget if needed
      if (window.TT && typeof window.TT.initializeWidgets === 'function') {
        window.TT.initializeWidgets();
      }
    });
  });
});